---
title: "Case Study - Bellabeat"
author: "Bruno"
date: "2025-10-23"
output: html_document
---

#Setting up the environment by installing packages and loading libraries
```{r}
install.packages("tidyverse")
install.packages("skimr")
install.packages("here")
install.packages("janitor")
install.packages("ggplot2") 
install.packages("lubridate")
install.packages("dplyr")             
install.packages("sqldf")
install.packages("plotrix")

library(tidyverse)
library(skimr)
library(here)
library(janitor)
library(ggplot2)  
library(lubridate)
library(dplyr)              
library(sqldf)
library(plotrix)
```

#Importing the files that will be used to R
```{r}
correct_path <- file.choose()
daily_activity <- read.csv("/cloud/project/dailyActivity_merged.csv")
daily_sleep <- read.csv("/cloud/project/sleepDay_merged.csv")
weight_info <- read.csv("/cloud/project/weightLogInfo_merged.csv")
```

#Opening each spreadsheet-style data
```{r}
View(daily_activity)
View(daily_sleep)
View(weight_info)
```

#Taking a closer look into the beginning of each data
```{r}
head(daily_activity)
head(daily_sleep)
head(weight_info)
```

#Understanding better each column structure and values
```{r}
str(daily_activity)
str(daily_sleep)
str(weight_info)
```

#Cleaning the data
```{r}
#removing the column 'Fat' due to missing values
weight_info_log <- weight_info %>%
  select(-Fat)
View(weight_info_log)

#counting and removing duplicate observations
duplicated_rows_activity <- sum(duplicated(daily_activity))
duplicated_rows_sleep <- sum(duplicated(daily_sleep))
duplicated_rows_steps <- sum(duplicated(daily_steps))
duplicated_rows_weight <- sum(duplicated(weight_info_log))

print(duplicated_rows_activity)
print(duplicated_rows_sleep)
print(duplicated_rows_steps)
print(duplicated_rows_weight)

daily_sleep <- unique(daily_sleep)

#Separating date and time into different columns
weight_info_log <- separate(weight_info_log, col=Date, into=c("Date","Time"),sep=" ",extra="drop")
View(weight_info_log)

daily_sleep <- separate(daily_sleep, col=SleepDay, into=c("Date","Time"),sep=" ",extra="drop")
View(daily_sleep)

#Changing the data type for future analysis
daily_sleep <- daily_sleep %>%
  mutate(Date = mdy(Date))

daily_sleep <- daily_sleep %>%
  mutate(Time = hms(Time))

weight_info_log <- weight_info_log %>%
  mutate(Date = mdy(Date))

weight_info_log <- weight_info_log %>%
  mutate(Time = hms(Time))

daily_activity <- daily_activity %>%
  mutate(ActivityDate = mdy(ActivityDate))

daily_steps <- daily_steps %>%
  mutate(ActivityDay = mdy(ActivityDay))
```

#General vision and statistical view of the data frames
```{r}
daily_activity %>%
  select(TotalSteps,
         TotalDistance,
         VeryActiveDistance,
         ModeratelyActiveDistance,
         LightActiveDistance,
         VeryActiveMinutes,
         FairlyActiveMinutes,
         LightlyActiveMinutes,
         SedentaryMinutes,
         Calories) %>%
  summary()

daily_sleep %>%
  select(TotalSleepRecords,
         TotalMinutesAsleep,
         TotalTimeInBed) %>%
  summary()

weight_info_log %>%
  select(WeightKg,
         BMI) %>%
  summary()
```

# Grouping inputs by weekday in order to check days where FitBit was used
```{r}
daily_activity_counts <- daily_activity %>%
  # 1. Extract the weekday as a number
  mutate(Weekday_Num = wday(ActivityDate)) %>%
  
  # 2. Group by the number
  group_by(Weekday_Num) %>%
  summarise(TotalInputs = n()) %>%
  
  # 3. Create a column called 'Weekday' with the correct order and name
  mutate(Weekday = factor(Weekday_Num, 
                          levels = 1:7, 
                          labels = c("Sunday", "Monday", "Tuesday", 
                                     "Wednesday", "Thursday", "Friday", 
                                     "Saturday"))) %>%
  
  # 4. Select e rearrange the final columns
  select(Weekday, TotalInputs) %>%
  arrange(Weekday)
```

# Providing now a graphic visualization
```{r}
ggplot(daily_activity_counts, aes(x = Weekday, y = TotalInputs, fill = Weekday)) +
  
  # Adding the bars
  geom_bar(stat = "identity", color = "black") +
  
  # Adding the exact number of entries on top of each bar
  geom_text(aes(label = TotalInputs), vjust = -0.5, size = 4) +
  
  # Define title and labels
  labs(
    title = "Usage across weekdays",
    subtitle = "Identifying the days with most usage",
    x = "Weekday",
    y = "Total records (Inputs)"
  ) +
  
  # Visual theme
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        legend.position = "none") +
  
  # Adjusting Y scale
  scale_y_continuous(expand = expansion(mult = c(0, 0.15)))
```

#Determining the correlation between total steps and calories 
```{r}
ggplot(data= daily_activity, aes(x=TotalSteps, y=Calories)) + 
  geom_point(color="green4") + 
  geom_smooth(color = "violetred4")+
  labs(title="Relationship Between Steps and Calories", x="Steps", y="Calories burned")
```

#Determining the correlation between amount of time in bed vs sleep time
```{r}
ggplot(data= daily_sleep, aes(x= TotalMinutesAsleep, y=TotalTimeInBed)) + 
  geom_point(color="green4") + 
  geom_smooth(color = "violetred4")+
  labs(title="Sleep time vs Time in bed ", x="Time asleep (minutes)", y="Total time in bed (minutes)")
```

